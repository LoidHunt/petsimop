local library = loadstring(game:HttpGet(('https://raw.githubusercontent.com/Maxgat5/UiLib/main/lua')))()
local w = library:CreateWindow("Wacky Wizards")
local b = w:CreateFolder("Potions")
local e = w:CreateFolder("Mix") 
local u = w:CreateFolder("Credits")

-- Cache services
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- Variables
local SelectedItem = "Brain"
local Items = {}
local RemoteEvent = ReplicatedStorage.RemoteEvent

-- Functions
local function findPlayerCauldron()
    for _, v in pairs(Workspace.PlayerCauldrons:GetDescendants()) do
        if v.ClassName == "TextLabel" and v.Text == "YOUR CAULDRON" then
            return v.Parent.Parent.Parent
        end
    end
end

local function refreshItems()
    Items = {}
    local cauldronOwner = findPlayerCauldron()
    if cauldronOwner then
        for _, item in pairs(Workspace.Interactions[cauldronOwner.Name]:GetChildren()) do
            if item:IsA("Model") then
                table.insert(Items, item.Name)
            end
        end
    end
end

local function addToCauldron(itemName)
    local cauldronOwner = findPlayerCauldron()
    if not cauldronOwner then return end
    
    local args = {
        {"PickUpItem", Workspace.Interactions[cauldronOwner.Name][itemName]},
        {"FireAllClients", "WeldItemToHand", 
            Workspace.Interactions[cauldronOwner.Name][itemName].Main.GripAttachment,
            Workspace[LocalPlayer.Name].RightHand.RightGripAttachment},
        {"FireAllClients", "UnweldItemFromHand",
            Workspace.Interactions[cauldronOwner.Name][itemName].Main},
        {"AddIngredientToCauldron",
            Workspace.PlayerCauldrons[cauldronOwner.Name].CauldronSet.Cauldron,
            Workspace.Interactions[cauldronOwner.Name][itemName]},
        {"FireAllClients", "EmitParticles",
            Workspace.PlayerCauldrons[cauldronOwner.Name].CauldronSet.Cauldron.Contents.ItemAdded,
            {Duration = 0.8}}
    }
    
    for _, arg in ipairs(args) do
        RemoteEvent:FireServer(unpack(arg))
    end
end

-- Initialize items
refreshItems()

-- UI Elements
b:Dropdown("Select Item", Items, true, function(mob)
    SelectedItem = mob
end)

b:Button("Put Into Cauldron", function()
    addToCauldron(SelectedItem)
end)

b:Button("Spawn Potion", function()
    local cauldronOwner = findPlayerCauldron()
    if cauldronOwner then
        RemoteEvent:FireServer("AttemptBottlePotion", 
            Workspace.PlayerCauldrons[cauldronOwner.Name].CauldronSet.Cauldron)
    end
end)

b:Button("Drain Cauldron", function()
    for _, v in pairs(Workspace.Interactions:GetChildren()) do
        RemoteEvent:FireServer("PickUpPotion", v)
    end
    
    local cauldronOwner = findPlayerCauldron()
    if cauldronOwner then
        RemoteEvent:FireServer("AttemptDrainCauldron",
            Workspace.PlayerCauldrons[cauldronOwner.Name].CauldronSet.Cauldron)
    end
end)

b:Button("Reset Character", function()
    RemoteEvent:FireServer("AttemptResetPlayer")
end)

local AntiAfk = false
local PotionRandomizer = false

e:Toggle("AntiAfk", function(bool)
    shared.toggle = bool
    AntiAfk = bool
end)

e:Toggle("Potion Randomizer", function(bool)
    shared.toggle = bool
    PotionRandomizer = bool
end)

u:Button("maxgat5#8395", function()
    setclipboard("maxgat5#8395")
end)

u:Button("Discord Server", function()
    setclipboard("https://discord.gg/K4txdRSVfq")
end)

-- Main loop
spawn(function()
    while wait() do
        if PotionRandomizer then
            pcall(function()
                refreshItems()
                for i = 1, #Items do
                    addToCauldron(Items[math.random(#Items)])
                end
                wait(3)
                
                local cauldronOwner = findPlayerCauldron()
                if cauldronOwner then
                    RemoteEvent:FireServer("AttemptBottlePotion",
                        Workspace.PlayerCauldrons[cauldronOwner.Name].CauldronSet.Cauldron)
                end
                
                wait(3)
                
                for _, v in pairs(Workspace.Interactions:GetChildren()) do
                    RemoteEvent:FireServer("PickUpPotion", v)
                end
                
                if cauldronOwner then
                    RemoteEvent:FireServer("AttemptDrainCauldron",
                        Workspace.PlayerCauldrons[cauldronOwner.Name].CauldronSet.Cauldron)
                end
            end)
        end
        
        if AntiAfk then
            local VirtualUser = game:GetService('VirtualUser')
            VirtualUser:CaptureController()
            VirtualUser:ClickButton2(Vector2.new())
        end
    end
end)

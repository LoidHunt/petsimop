local ScreenGui = Instance.new("ScreenGui")
local MainFrame = Instance.new("Frame")
local Title = Instance.new("TextLabel")
local PotionRandomizer = Instance.new("TextButton")
local Dragging = false
local DragStart = nil
local StartPos = nil

ScreenGui.Parent = game.CoreGui
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

MainFrame.Name = "MainFrame"
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
MainFrame.BorderSizePixel = 0
MainFrame.Position = UDim2.new(0.3, 0, 0.3, 0)
MainFrame.Size = UDim2.new(0, 200, 0, 100)

Title.Name = "Title"
Title.Parent = MainFrame
Title.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
Title.BorderSizePixel = 0
Title.Size = UDim2.new(1, 0, 0, 30)
Title.Font = Enum.Font.SourceSansBold
Title.Text = "Wacky Wizards"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextSize = 16

PotionRandomizer.Name = "PotionRandomizer"
PotionRandomizer.Parent = MainFrame
PotionRandomizer.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
PotionRandomizer.BorderSizePixel = 0
PotionRandomizer.Position = UDim2.new(0.1, 0, 0.4, 0)
PotionRandomizer.Size = UDim2.new(0.8, 0, 0, 30)
PotionRandomizer.Font = Enum.Font.SourceSans
PotionRandomizer.Text = "Potion Randomizer: OFF"
PotionRandomizer.TextColor3 = Color3.fromRGB(255, 255, 255)
PotionRandomizer.TextSize = 14

local PotionRandomizerEnabled = false
SelectedItem = "Brain"
Items = {}

-- Make GUI draggable
Title.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        Dragging = true
        DragStart = input.Position
        StartPos = MainFrame.Position
    end
end)

Title.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        Dragging = false
    end
end)

game:GetService("UserInputService").InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement and Dragging then
        local delta = input.Position - DragStart
        MainFrame.Position = UDim2.new(
            StartPos.X.Scale, 
            StartPos.X.Offset + delta.X,
            StartPos.Y.Scale, 
            StartPos.Y.Offset + delta.Y
        )
    end
end)

PotionRandomizer.MouseButton1Click:Connect(function()
    PotionRandomizerEnabled = not PotionRandomizerEnabled
    PotionRandomizer.Text = "Potion Randomizer: " .. (PotionRandomizerEnabled and "ON" or "OFF")
end)

while wait() do
    pcall(function()
        if PotionRandomizerEnabled == true then
            Items = {}
            for i,v in pairs(game:GetService("Workspace").PlayerCauldrons:GetDescendants()) do
                if v.ClassName == "TextLabel" then
                    if v.Text == "YOUR CAULDRON" then
                        for i,v1 in pairs(game:GetService("Workspace").Interactions[v.Parent.Parent.Parent.Name]:GetChildren()) do
                            if v1.ClassName == "Model" then
                                table.insert(Items,v1.Name)
                            end
                        end
                    end
                end
            end
            
            for i,v1 in pairs(Items) do
                local randomnumber = math.random(1,i)
                for i,v in pairs(game:GetService("Workspace").PlayerCauldrons:GetDescendants()) do
                    if v.ClassName == "TextLabel" then
                        if v.Text == "YOUR CAULDRON" then
                            local args = {
                                [1] = "PickUpItem",
                                [2] = workspace.Interactions[v.Parent.Parent.Parent.Name][Items[randomnumber]],
                            }
                            game:GetService("ReplicatedStorage").RemoteEvent:FireServer(unpack(args))
                            
                            local args = {
                                [1] = "FireAllClients",
                                [2] = "WeldItemToHand",
                                [3] = workspace.Interactions[v.Parent.Parent.Parent.Name][Items[randomnumber]].Main.GripAttachment,
                                [4] = workspace[game.Players.LocalPlayer.Name].RightHand.RightGripAttachment,
                            }
                            game:GetService("ReplicatedStorage").RemoteEvent:FireServer(unpack(args))
                            
                            local args = {
                                [1] = "FireAllClients",
                                [2] = "UnweldItemFromHand",
                                [3] = workspace.Interactions[v.Parent.Parent.Parent.Name][Items[randomnumber]].Main,
                            }
                            game:GetService("ReplicatedStorage").RemoteEvent:FireServer(unpack(args))
                            
                            local args = {
                                [1] = "AddIngredientToCauldron",
                                [2] = workspace.PlayerCauldrons[v.Parent.Parent.Parent.Name].CauldronSet.Cauldron,
                                [3] = workspace.Interactions[v.Parent.Parent.Parent.Name][Items[randomnumber]],
                            }
                            game:GetService("ReplicatedStorage").RemoteEvent:FireServer(unpack(args))
                            
                            local args = {
                                [1] = "FireAllClients",
                                [2] = "EmitParticles",
                                [3] = workspace.PlayerCauldrons[v.Parent.Parent.Parent.Name].CauldronSet.Cauldron.Contents.ItemAdded,
                                    [4] = {
                                    ["Duration"] = 0.8,
                                },
                            }
                            game:GetService("ReplicatedStorage").RemoteEvent:FireServer(unpack(args))
                        end
                    end
                end
            end
            wait(3)
            for i,v in pairs(game:GetService("Workspace").PlayerCauldrons:GetDescendants()) do
                if v.ClassName == "TextLabel" then
                    if v.Text == "YOUR CAULDRON" then
                        game:GetService("ReplicatedStorage").RemoteEvent:FireServer("AttemptBottlePotion",workspace.PlayerCauldrons[v.Parent.Parent.Parent.Name].CauldronSet.Cauldron)
                    end
                end
            end
            wait(3)
            for i,v in pairs(workspace.Interactions:GetChildren()) do
                local args = {
                    [1] = "PickUpPotion",
                    [2] = v,
                }
                
                game:GetService("ReplicatedStorage").RemoteEvent:FireServer(unpack(args))
            end
            for i,v in pairs(game:GetService("Workspace").PlayerCauldrons:GetDescendants()) do
                if v.ClassName == "TextLabel" then
                    if v.Text == "YOUR CAULDRON" then
                        game:GetService("ReplicatedStorage").RemoteEvent:FireServer("AttemptDrainCauldron",workspace.PlayerCauldrons[v.Parent.Parent.Parent.Name].CauldronSet.Cauldron)
                    end
                end
            end
        end
    end)
end
